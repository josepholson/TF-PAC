% 2_Compare TF_MVL and Hilbert-MVL 
% This script compares the proposed time-frequency based phase amplitude coupling measure 
% with existing Hilbert transform based method. Both methods use MVL measure for 
% quantifying the coupling. First a synthesized signal is produced with PAC generated between 10Hz
% and 70Hz; after that PAC is esmated using TF_MVL and Hilbert-MVL algorithms. Comodulograms are 
% plotted to show the coupling between high and low frequency for both methods. 
% Finally Shannon entropy is computed to compare each methods
% 
% Written by: Tamanna T. K. Munia, January 2019

% These scripts have been optimised for the Windows operating systm  
% MATLAB version used 2018a.

%% Input directory information

  warning off;
  addpath('tfdnmfiles');
  addpath('preproc');

%% Generate synthesized signal

  syn_sig = generate_syn_signal(10, 70, 6, 1000, 10);

%% Compute TF_MVL for each subject

  x=syn_sig;
  high=[30 100]; % set the required amplitude frequency range
  low=[7 13]; % set the required phase frequency range
 
  highfreq=high(1):2:high(2);
  amp_length=length(highfreq);
  lowfreq=low(1):1:low(2);
  phase_length=length(lowfreq);
  tf_MVL_all = zeros(amp_length,phase_length);
  Hilbert_MVL_all = zeros(amp_length,phase_length);
   

for i=1:phase_length
  for j=1:amp_length
      l_freq= lowfreq(i);
      h_freq= highfreq(j);
      [tf_MVL_all(j,i)]=tfMVL(x, h_freq, l_freq);
      [Hilbert_MVL_all(j,i)]=hilMVL(x, h_freq, l_freq);
  end
end

%% plot the comodulograms of tf-MVL and Hilbert-MVL methods
plot_comodulogram(abs(tf_MVL_all),high,low); %plot comodulogram of tf-MVL method
plot_comodulogram(abs(Hilbert_MVL_all),high,low); %plot comodulogram of Hilbert-MVL method

%% Calculate shannon entropy

tf_normalized = tf_MVL_all / sum(tf_MVL_all(:));
Hilbert_normalized = Hilbert_MVL_all / sum(Hilbert_MVL_all(:));

tf_ShEn = ShannonEn(tf_normalized,1,2);
Hil_ShEn = ShannonEn(Hilbert_normalized,1,2);

ShEn=[tf_ShEn, Hil_ShEn];
disp('   tf_ShEn  Hilbert_ShEn');
disp(ShEn);
