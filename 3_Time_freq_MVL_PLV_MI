% 3_Time_freq_MVL_PLV_MI
% This script computes time-frequency based phase amplitude coupling using 
% MVL, MI and PLV methods and plot the comodulograms.
% First a synthesized signal is produced with PAC generated between 5Hz
% and 70Hz; Proposed RID-Rihakzek based TF algorithm is then applied to determine 
% the coupling using MVL, MI and PLV method. The comodulograms are plotted to 
% show the coupling between high and low frequency.
% 
% Written by: Tamanna T. K. Munia, January 2019
% Please cite: Munia, Tamanna TK, and Selin Aviyente. "time-frequency Based phase-Amplitude 
% coupling Measure for neuronal oscillations." Scientific reports 9, no. 1 (2019): 1-15.

% These scripts have been optimised for the Windows operating systm  
% MATLAB version used 2018a.


%% Input directory information
  warning off;
  addpath('tfdnmfiles');

%% Generate synthesized signal
  Fs=1000; % sampling frequency
  syn_sig = generate_syn_signal(5, 70, 3, Fs, 10);

%% Compute TF_MVL for each subject

  x=syn_sig;
  high=[40 100]; % set the required amplitude frequency range
  low=[2 10]; % set the required phase frequency range
  highfreq=high(1):2:high(2);
  amp_length=length(highfreq);
  lowfreq=low(1):1:low(2);
  phase_length=length(lowfreq);
  tf_MVL_all = zeros(amp_length,phase_length);
  tf_PLV_all= zeros(amp_length,phase_length);
  tf_MI_all = zeros(amp_length,phase_length);
for i=1:phase_length
  for j=1:amp_length
      l_freq= lowfreq(i);
      h_freq= highfreq(j);
      [tf_MVL_all(j,i),tf_PLV_all(j,i), tf_MI_all(j,i)]=tfMVL_all(x, h_freq, l_freq, Fs);
     
  end
end

tf_MVL=abs(max(max(tf_MVL_all))); % Computed tf-MVL value
tf_PLV=abs(max(max(tf_PLV_all))); % Computed tf-PLV value
tf_MI=abs(max(max(tf_MI_all))); % Computed tf-MI value

plot_comodulogram(tf_MVL_all,high,low) % plot tf_MVL comodulogram
plot_comodulogram(tf_PLV_all,high,low) % plot tf_PLV comodulogram
plot_comodulogram(tf_MI_all,high,low) % plot tf_MI comodulogram
 
